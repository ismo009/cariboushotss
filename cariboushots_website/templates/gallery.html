{% extends "base.html" %}

{% block title %}
    {% if current_folder_name %}
        {{ current_folder_name }} - Gallery
    {% else %}
        Photo Gallery
    {% endif %}
{% endblock %}

{% block content %}
<div class="gallery-container">
    <h2>Club Photo Gallery</h2>

    <h3>
        Currently viewing:
        <a href="{{ url_for('gallery', folder_id=current_folder_id if current_folder_id != MAIN_CLUB_FOLDER_ID else None) }}">
            {{ current_folder_name }}
        </a>
    </h3>

    {# Back navigation link #}
    {% if current_folder_id != MAIN_CLUB_FOLDER_ID %} {# Only show 'Back' if not in the root of the gallery #}
        <p>
            <a href="{{ url_for('gallery', folder_id=parent_folder_id if parent_folder_id else None) }}">
                &laquo; Back to
                {% if parent_folder_id %}
                    previous folder
                {% else %}
                    Main Gallery
                {% endif %}
            </a>
        </p>
    {% endif %}

    {% if folders %}
        <h4>Sub-folders:</h4>
        <ul class="folder-list">
            {% for folder in folders %}
                <li>
                    <a href="{{ url_for('gallery', folder_id=folder.id) }}">{{ folder.name }}</a>
                    <small class="text-muted"> (ID: {{ folder.id }})</small> {# Optional: for debugging #}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No sub-folders found in {{ current_folder_name }}.</p>
    {% endif %}

    <hr>

    {% if photos %}
        <h4>Photos in {{ current_folder_name }}:</h4>
        <div class="photo-grid">
            {% for photo in photos %}
                <div class="photo-item">
                    <a href="{{ photo.webViewLink if photo.webViewLink else '#' }}" target="_blank" title="View '{{ photo.name }}' on Google Drive">
                        {# Use a placeholder if thumbnailLink is missing, or if it's known to be problematic #}
                        <img src="{{ photo.thumbnailLink if photo.thumbnailLink else url_for('static', filename='images/placeholder_image.png') }}"
                             alt="{{ photo.name }}"
                             onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/placeholder_image.png') }}';"> {# Fallback if thumbnail fails to load #}
                        <p>{{ photo.name }}</p>
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No photos found in {{ current_folder_name }}.</p>
    {% endif %}

</div>
{% endblock %}
